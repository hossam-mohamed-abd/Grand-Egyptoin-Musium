# شرح تفصيلي للشفرة

## نظرة عامة على عمل المشروع
المشروع هو موقع ثابت يعتمد على PHP بهيكل MVC مبسط. جميع الطلبات تمر عبر متحكم أمامي في `public/index.php` يقوم بتحميل الإعدادات، ثم يوجّه الطلبات من خلال موجه مخصص في `app/core/Router.php`. يقوم الموجه بربط المسارات بقوالب PHP داخل `app/views/` مع استخدام مكونات مشتركة للأجزاء المتكررة في الواجهة. الأصول الثابتة (CSS وJS وصور) مخزنة في `public/assets` ويتم ربطها عبر ثابت `ASSETS` لضمان مسارات صحيحة في بيئات مختلفة.

## شرح الملفات الرئيسية
- **`public/index.php`**: نقطة الدخول لكل الطلبات. تحمّل الإعدادات من `app/config/config.php`، تهيئ الموجه، وتستدعي تعريفات المسارات من `app/routes.php` قبل تنفيذ التوجيه.
- **`app/config/config.php`**: يحتوي ثوابت المشروع مثل `BASE_URL`، مسار التطبيق `APP_PATH`، مسار القوالب `VIEW_PATH`، ومسار الأصول `ASSETS`. تعديل هذه القيم يحدد كيفية بناء الروابط وتشغيل الموقع في بيئات متعددة.
- **`app/core/Router.php`**: فئة بسيطة تتولى تسجيل المسارات عبر دوال `get` و`post`. تحتفظ بالمصفوفات التي تربط المسارات بوظائف استجابة أو ملفات قوالب، ثم تتولى اختيار الاستجابة المناسبة بناءً على طريقة الطلب والمسار.
- **`app/core/Controller.php`**: فئة أساسية توفر دالة `render($view, $data = [])` التي تستخرج المتغيرات من المصفوفة `$data` ثم تتضمن ملف القالب المطلوب. مفيدة عند بناء وحدات تحكم مستقبلية.
- **`app/routes.php`**: يسجل المسارات باستخدام الموجه. في النسخة الحالية يتم توجيه المسارات مباشرة إلى ملفات القوالب أو الاستجابات البسيطة.
- **`app/views/`**: يحتوي ملفات القوالب لكل صفحة. هناك مجلدات فرعية مثل `booking/`، `Kids-Zone/`، `Collections/`، و`Donate/` لكل قسم، بالإضافة إلى مجلد `components/` الذي يضم الرأس والتذييل وأي أجزاء مشتركة أخرى.
- **`public/assets/`**: يشمل ملفات الستايل والسكربتات والصور. يتم الوصول إليها عبر ثابت `ASSETS` لتجنب الروابط المطلقة في القوالب.

## تدفق البيانات داخل المشروع
1. يتلقى الخادم الطلب ويوجهه إلى `public/index.php` بفضل إعدادات الخادم أو ملف `.htaccess` (إن وجد).
2. يقوم `index.php` بتحميل الإعدادات ثم إنشاء كائن من `Router`.
3. يتم تحميل ملف `app/routes.php` الذي يسجّل جميع المسارات باستخدام الموجه.
4. عند تنفيذ `Router->dispatch()`, يحدد الموجه المسار والتابع المناسبين ويشغلهما.
5. إذا كان المسار مرتبطًا بقالب، يتم تضمينه عبر `render` (عند استخدام وحدات تحكم) أو مباشرة من ملف المسارات، ليتم إنتاج HTML النهائي للمستخدم.

## منطق أو خوارزميات مهمة
- **التوجيه البسيط**: يعتمد على مطابقة نصية للمسار وطريقة الطلب، دون تحليل معقد للمعاملات. هذا يسهّل الإعداد لكنه يتطلب تعريفًا صريحًا لكل مسار.
- **إدارة الأصول**: استخدام الثوابت `BASE_URL` و`ASSETS` يضمن تكوين الروابط بشكل صحيح حتى عند تغيير مسار النشر.

## كيفية التعديل أو التوسيع
- **إضافة صفحة جديدة**: أنشئ قالبًا في `app/views/<folder>/page.php` أو مباشرة تحت `views/`. أضف المسار في `app/routes.php` باستخدام `$router->get('/path', function () { include VIEW_PATH . '...'; });` أو عبر استدعاء وحدة تحكم تستخدم `render`.
- **توسيع الموجه**: يمكن تعديل `Router.php` لإضافة دعم للوسائط المتعددة، المعاملات الديناميكية، أو صفحات خطأ مخصصة.
- **إضافة منطق عمل**: أنشئ فئة متحكم جديدة تمتد من `Controller` لحقن بيانات في القوالب أو تنفيذ عمليات قبل العرض.
- **إدارة الأصول**: ضع الملفات تحت `public/assets` واستخدم الثابت `ASSETS` داخل القوالب لربطها.

## ملاحظات وتحذيرات للمطورين
- تأكد من ضبط `BASE_URL` قبل النشر لتجنب روابط مكسورة، خاصة عند استضافة الموقع في مجلد فرعي.
- بعض الملفات قد تحتوي على تعارضات دمج سابقة؛ يوصى بمراجعتها وإزالة أي علامات تعارض قبل الدفع للإنتاج.
- لا توجد طبقة أمان أو تحقق من المدخلات، لذلك أي مدخلات ديناميكية مستقبلية يجب أن تمر عبر فلاتر وتنقية مناسبة.
- غياب الاختبارات الآلية يعني ضرورة اختبار المسارات يدويًا بعد أي تعديل.

## أمثلة أو توضيحات
- **رسم نصي لتدفق الطلب**:
  ```
  متصفح → خادم الويب → public/index.php → Router → القالب في app/views → HTML الناتج
  ```
- **مثال مسار بسيط** في `app/routes.php`:
  ```php
  $router->get('/donate', function () {
      include VIEW_PATH . 'Donate/donate.php';
  });
  ```
